<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mahart Linked Notes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-900 text-gray-100 font-sans antialiased">

    <div id="app-container" class="flex h-screen">

        <!-- Enhanced Compact Resizable Sidebar -->
        <nav id="main-sidebar" class="w-52 bg-gray-800 text-white flex flex-col shadow-lg transition-all duration-300 resize-x min-w-[200px] max-w-[400px] relative">
            <!-- Sidebar Header with Controls -->
            <div class="p-3 border-b border-gray-700 flex items-center justify-between">
                <h1 class="text-lg font-bold truncate">MahartNotes</h1>
                <div class="flex items-center gap-1">
                    <button id="sidebar-search" class="p-1 rounded hover:bg-gray-700 transition-colors" title="Quick Search (⌘K)">
                        <i class="fas fa-search text-xs"></i>
                    </button>
                    <button id="sidebar-collapse" class="p-1 rounded hover:bg-gray-700 transition-colors" title="Collapse Sidebar">
                        <i class="fas fa-chevron-left text-xs"></i>
                    </button>
                </div>
            </div>

            <!-- Quick Actions Bar -->
            <div class="px-2 py-2 border-b border-gray-700 flex gap-1">
                <button id="new-note-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs transition-colors" title="New Note (⌘N)">
                    <i class="fas fa-plus mr-1"></i>Note
                </button>
                <button id="command-palette-btn" class="px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs transition-colors" title="Commands (⌘P)">
                    <i class="fas fa-terminal"></i>
                </button>
            </div>

            <!-- Main Navigation -->
            <div class="flex-grow overflow-y-auto">
                <!-- Core Section -->
                <div class="border-b border-gray-700">
                    <div class="px-2 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wide">Core</div>
                    <ul class="p-1">
                        <li><a href="#/" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-pencil-alt w-4 mr-2 text-center text-xs"></i><span class="truncate">Editor</span><kbd class="ml-auto text-xs bg-gray-700 px-1 rounded">⌘E</kbd></a></li>
                        <li><a href="#/graph" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-project-diagram w-4 mr-2 text-center text-xs"></i><span class="truncate">Graph</span><kbd class="ml-auto text-xs bg-gray-700 px-1 rounded">⌘G</kbd></a></li>
                        <li><a href="#/search" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-search w-4 mr-2 text-center text-xs"></i><span class="truncate">Search</span><kbd class="ml-auto text-xs bg-gray-700 px-1 rounded">⌘F</kbd></a></li>
                        <li><a href="#/tags" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-tags w-4 mr-2 text-center text-xs"></i><span class="truncate">Tags</span><kbd class="ml-auto text-xs bg-gray-700 px-1 rounded">⌘T</kbd></a></li>
                    </ul>
                </div>

                <!-- Analytics & Insights -->
                <div class="border-b border-gray-700">
                    <div class="px-2 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wide">Analytics</div>
                    <ul class="p-1">
                        <li><a href="#/analytics" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-chart-line w-4 mr-2 text-center text-xs"></i><span class="truncate">Dashboard</span></a></li>
                        <li><a href="#/insights" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-lightbulb w-4 mr-2 text-center text-xs"></i><span class="truncate">Insights</span></a></li>
                        <li><a href="#/timeline" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-clock w-4 mr-2 text-center text-xs"></i><span class="truncate">Timeline</span></a></li>
                    </ul>
                </div>

                <!-- Tools & Productivity -->
                <div class="border-b border-gray-700">
                    <div class="px-2 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wide">Tools</div>
                    <ul class="p-1">
                        <li><a href="#/templates" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-file-alt w-4 mr-2 text-center text-xs"></i><span class="truncate">Templates</span></a></li>
                        <li><a href="#/presentations" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-presentation w-4 mr-2 text-center text-xs"></i><span class="truncate">Presentations</span></a></li>
                        <li><a href="#/export" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-download w-4 mr-2 text-center text-xs"></i><span class="truncate">Export Hub</span></a></li>
                        <li><a href="#/backup" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-shield-alt w-4 mr-2 text-center text-xs"></i><span class="truncate">Backup</span></a></li>
                    </ul>
                </div>

                <!-- AI & Automation -->
                <div class="border-b border-gray-700">
                    <div class="px-2 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wide">AI & Auto</div>
                    <ul class="p-1">
                        <li><a href="#/ai" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-robot w-4 mr-2 text-center text-xs"></i><span class="truncate">AI Assistant</span></a></li>
                        <li><a href="#/recommendations" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-magic w-4 mr-2 text-center text-xs"></i><span class="truncate">Suggestions</span></a></li>
                        <li><a href="#/learning" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-graduation-cap w-4 mr-2 text-center text-xs"></i><span class="truncate">Learning</span></a></li>
                    </ul>
                </div>

                <!-- Workspace & Settings -->
                <div>
                    <div class="px-2 py-1 text-xs font-semibold text-gray-400 uppercase tracking-wide">System</div>
                    <ul class="p-1">
                        <li><a href="#/workspace" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-layer-group w-4 mr-2 text-center text-xs"></i><span class="truncate">Workspace</span></a></li>
                        <li><a href="#/themes" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-palette w-4 mr-2 text-center text-xs"></i><span class="truncate">Themes</span></a></li>
                        <li><a href="#/plugins" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-plug w-4 mr-2 text-center text-xs"></i><span class="truncate">Plugins</span></a></li>
                        <li><a href="#/settings" class="nav-item flex items-center py-1.5 px-2 rounded text-sm hover:bg-blue-600 transition-colors duration-200"><i class="fas fa-cog w-4 mr-2 text-center text-xs"></i><span class="truncate">Settings</span></a></li>
                    </ul>
                </div>
            </div>

            <!-- Sidebar Footer with Status -->
            <div class="p-2 border-t border-gray-700">
                <div class="flex items-center justify-between text-xs text-gray-400">
                    <span>v2.1.0</span>
                    <div class="flex items-center gap-1">
                        <div id="sync-status" class="w-2 h-2 bg-green-500 rounded-full" title="Synced"></div>
                        <span id="note-counter">0 notes</span>
                    </div>
                </div>
                <div class="mt-1 text-xs text-gray-500 truncate" id="current-workspace">Default Workspace</div>
            </div>

            <!-- Resize Handle -->
            <div id="sidebar-resize-handle" class="absolute top-0 right-0 w-1 h-full bg-gray-600 opacity-0 hover:opacity-100 cursor-col-resize transition-opacity" title="Drag to resize"></div>
        </nav>

        <!-- Main Content Area -->
        <main id="main-content" class="flex-1 p-4 md:p-6 lg:p-8 overflow-y-auto bg-gray-900">

            <!-- Page: Home/Editor -->
            <div id="page-home" class="page h-full flex gap-4">
                <!-- Left Column for Note List -->
                <div class="w-1/3 max-w-sm bg-gray-800 rounded-lg p-4 flex flex-col shadow-inner">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold">Notes</h2>
                        <span id="noteCount" class="text-sm font-medium text-gray-400 bg-gray-700 px-2 py-1 rounded-full"></span>
                    </div>
                    <div id="noteList" class="flex-grow overflow-y-auto -mr-4 pr-4">
                        <!-- Note items will be rendered here by app.js -->
                    </div>
                </div>

                <!-- Right Column for Editor/Preview -->
                <div class="flex-grow grid grid-cols-1 lg:grid-cols-2 gap-4">
                    <div class="card flex flex-col">
                      <h3 class="card-header flex items-center gap-2">
                        Editor 
                        <span id="dirty" class="badge hidden">unsaved</span>
                        <div class="ml-auto flex items-center gap-2">
                          <button id="noteColorButton" class="w-6 h-6 rounded-full border-2 border-gray-500 hover:border-gray-300 transition-colors cursor-pointer" style="background-color: #6B7280;" title="Set note color"></button>
                          <div id="colorPickerMenu" class="hidden absolute top-12 right-4 bg-gray-800 border border-gray-600 rounded-lg p-2 shadow-lg z-50">
                            <div class="grid grid-cols-4 gap-1">
                              <button class="color-option w-6 h-6 rounded-full border border-gray-500 hover:border-white transition-colors" style="background-color: #6B7280;" data-color="#6B7280" title="Gray"></button>
                              <button class="color-option w-6 h-6 rounded-full border border-gray-500 hover:border-white transition-colors" style="background-color: #3B82F6;" data-color="#3B82F6" title="Blue"></button>
                              <button class="color-option w-6 h-6 rounded-full border border-gray-500 hover:border-white transition-colors" style="background-color: #10B981;" data-color="#10B981" title="Green"></button>
                              <button class="color-option w-6 h-6 rounded-full border border-gray-500 hover:border-white transition-colors" style="background-color: #F59E0B;" data-color="#F59E0B" title="Amber"></button>
                              <button class="color-option w-6 h-6 rounded-full border border-gray-500 hover:border-white transition-colors" style="background-color: #EF4444;" data-color="#EF4444" title="Red"></button>
                              <button class="color-option w-6 h-6 rounded-full border border-gray-500 hover:border-white transition-colors" style="background-color: #8B5CF6;" data-color="#8B5CF6" title="Purple"></button>
                              <button class="color-option w-6 h-6 rounded-full border border-gray-500 hover:border-white transition-colors" style="background-color: #F97316;" data-color="#F97316" title="Orange"></button>
                              <button class="color-option w-6 h-6 rounded-full border border-gray-500 hover:border-white transition-colors" style="background-color: #06B6D4;" data-color="#06B6D4" title="Cyan"></button>
                            </div>
                          </div>
                        </div>
                      </h3>
                      <div class="flex-grow h-editor overflow-auto p-1">
                        <textarea id="editor" placeholder="# Title..." class="editor-textarea"></textarea>
                      </div>
                      <div class="flex gap-2 p-2 border-t border-card-border">
                        <input id="title" placeholder="Note Title" class="input-field flex-1"/>
                        <button id="saveNoteInline" class="btn ml-2" title="Save note (⌘/Ctrl+S)">Save</button>
                      </div>
                    </div>
                    <div class="card flex flex-col">
                      <h3 class="card-header">Live Preview</h3>
                      <div id="preview" class="flex-grow h-editor overflow-auto p-3"></div>
                    </div>
                </div>
            </div>

            <!-- Page: Graph -->
            <div id="page-graph" class="page hidden h-full">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-3xl font-bold text-white">Knowledge Graph</h2>
                    <div class="flex items-center gap-4">
                        <label class="text-white text-sm font-medium">Link by:</label>
                        <div class="flex bg-gray-700 rounded-lg p-1">
                            <button id="linkByTags" class="px-3 py-1 rounded text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition-colors">Tags</button>
                            <button id="linkByColors" class="px-3 py-1 rounded text-sm font-medium text-gray-300 hover:bg-gray-600 transition-colors">Colors</button>
                        </div>
                    </div>
                </div>
                <div id="graphContainer" class="w-full h-[80vh] rounded bg-gray-800 border border-gray-700"></div>
            </div>

            <!-- Page: Tags -->
            <div id="page-tags" class="page hidden">
                <div class="card p-4 max-h-[80vh] overflow-auto">
                    <div class="flex justify-between items-center mb-4">
                      <h3 class="m-0 text-xl font-semibold text-text">Tag Management</h3>
                    </div>
                    <div class="mb-4">
                      <div class="flex gap-2 mb-2">
                        <input id="newTagInput" placeholder="Create new tag..." class="input-field flex-1">
                        <button class="btn" onclick="UI.createNewTag()">Add Tag</button>
                      </div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-4">
                      <div class="flex-1">
                        <h4 class="text-lg font-medium mb-2">All Tags <span id="totalTagCount" class="badge">0</span></h4>
                        <div id="allTagsList" class="max-h-96 overflow-auto border border-card-border rounded-lg p-2"></div>
                      </div>
                      <div class="flex-1">
                        <h4 class="text-lg font-medium mb-2">Tag Details</h4>
                        <div id="tagDetails" class="border border-card-border rounded-lg p-3 min-h-48"></div>
                      </div>
                    </div>
                </div>
            </div>

            <!-- Page: AI Assistant -->
            <div id="page-ai" class="page hidden">
                <h2 class="text-3xl font-bold mb-4 text-white">AI Assistant</h2>
                 <div class="bg-gray-800 p-6 rounded-lg h-[80vh]">
                    <p class="text-gray-400">The AI Assistant interface will be rendered here.</p>
                 </div>
            </div>

            <!-- Page: Settings -->
            <div id="page-settings" class="page hidden">
                <div class="card p-4 min-w-[420px]">
                    <h3 class="text-xl font-semibold text-text mb-4">Settings</h3>
                    <label class="flex items-center justify-between py-2 text-sm">
                      <span>Auto-link on save:</span>
                      <input id="autoLink" type="checkbox" checked class="ml-2">
                    </label>
                    <label class="flex items-center justify-between py-2 text-sm">
                      <span>Enable analytics:</span>
                      <input id="enableAnalytics" type="checkbox" checked class="ml-2">
                    </label>
                    <label class="flex items-center justify-between py-2 text-sm">
                      <span>Realtime multi-tab sync:</span>
                      <input id="enableBC" type="checkbox" checked class="ml-2">
                    </label>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50">
        Toast message
    </div>

    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    
    <script src="js/util.js"></script>
    <script src="js/router.js"></script>
    <script src="js/store.js"></script>
    <script src="js/search.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/graph.js"></script>
    <script src="js/tags.js"></script>
    <script src="js/templates.js"></script>
    <script src="js/recommendations.js"></script>
    <script src="js/collaboration.js"></script>
    <script src="js/graph-analytics.js"></script>
    <script src="js/query-engine.js"></script>
    <script src="js/advanced-viz.js"></script>
    <script src="js/ai-assistant.js"></script>
    <script src="js/advanced-ui.js"></script>
    <script src="js/plugin-system.js"></script>
    <script src="js/data-management.js"></script>
    <script src="js/advanced-search.js"></script>
    <script src="js/advanced-editor.js"></script>
    <script src="js/monetization.js"></script>
    <script src="js/workspace.js"></script>
    <script src="js/themes.js"></script>
    <script src="js/presentation-generator.js"></script>
    <script src="js/smart-templates.js"></script>
    <script src="js/learning-mode.js"></script>
    <script src="js/theme-editor.js"></script>
    <script src="js/competitive-importers.js"></script>
    <script src="js/dynamic-dashboards.js"></script>
    <script src="js/app.js"></script>
    <script src="js/init.js"></script>
</body>
</html>
