<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark light">
    <title>Mahart Linked Notes</title>
    <meta name="description" content="Advanced client-side knowledge management platform with AI assistance">
    
    <!-- Preconnect & preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" as="style">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PWA Meta -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1e293b">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    <!-- Modern Dark Theme Styles -->
    <link rel="stylesheet" href="/css/styles.css">
  </head>
<body class="font-primary" data-theme="dark">
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <!-- Loading Screen -->
    <div id="app-loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-semibold); color: var(--color-text-primary); margin-bottom: var(--space-sm);">Loading Mahart Notes</h2>
            <p style="font-size: var(--font-size-sm); color: var(--color-text-muted);">Initializing your knowledge workspace...</p>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="app" class="hidden">
        <!-- Sidebar Navigation -->
        <nav id="sidebar" data-testid="sidebar" role="navigation" aria-label="Primary">
            <!-- Sidebar Header -->
            <header class="sidebar-header">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-md);">
                    <h1>Mahart Notes</h1>
                    <div style="display: flex; align-items: center; gap: var(--space-sm);">
                        <!-- Sync Status Indicator -->
                        <div id="sync-status" style="width: 8px; height: 8px; background: var(--color-accent-success); border-radius: 50%; box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);" title="Application status"></div>
                        <!-- Menu Toggle for Mobile -->
                        <button id="mobile-menu-toggle" data-testid="mobile-menu-toggle" class="btn btn-ghost btn-icon lg:hidden">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button id="new-note-btn" data-testid="new-note-btn" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-plus"></i>
                        <span>New Note</span>
                    </button>
                    <button id="search-toggle-btn" class="btn btn-secondary btn-icon">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <!-- Search Bar -->
                <div id="search-container" class="search-container">
                    <div class="search-input-wrapper">
                        <i class="search-icon fas fa-search"></i>
                        <input 
                            type="text" 
                            id="search-input" 
                            data-testid="search-input"
                            class="search-input" 
                            placeholder="Search notes... (⌘K)"
                        >
                    </div>
                    <div id="search-results" data-testid="search-results" class="search-results hidden"></div>
                </div>
            </header>
            
            <!-- Navigation Menu -->
            <div class="sidebar-body">
                <nav class="sidebar-nav">
                    <a href="#/" data-route="#/" class="sidebar-nav-item">
                        <i class="fas fa-edit"></i>
                        <span>Editor</span>
                        <kbd>⌘E</kbd>
                    </a>
                    <a href="#/graph" data-route="#/graph" class="sidebar-nav-item">
                        <i class="fas fa-project-diagram"></i>
                        <span>Knowledge Graph</span>
                        <kbd>⌘G</kbd>
                    </a>
                    <a href="#/tags" data-route="#/tags" class="sidebar-nav-item">
                        <i class="fas fa-tags"></i>
                        <span>Tag Management</span>
                        <kbd>⌘T</kbd>
                    </a>
                    <a href="#/ai" data-route="#/ai" class="sidebar-nav-item">
                        <i class="fas fa-brain"></i>
                        <span>AI Assistant</span>
                        <kbd>⌘A</kbd>
                    </a>
                    <a href="#/settings" data-route="#/settings" class="sidebar-nav-item">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </nav>
                
                <!-- Note List -->
                <div>
                    <div class="note-list-header">
                        <h3 class="note-list-title">Notes</h3>
                        <span id="note-count" data-testid="note-count" class="note-count">0 notes</span>
                    </div>
                    <div id="note-list" data-testid="note-list" class="note-list">
                        <!-- Note items will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Sidebar Footer -->
            <footer class="sidebar-footer">
                <div style="text-align: center; font-size: var(--font-size-xs); color: var(--color-text-muted);">
                    <div style="margin-bottom: var(--space-xs);">v2.0.0</div>
                    <button id="theme-toggle" class="btn btn-ghost btn-sm">
                        <i class="fas fa-palette"></i>
                        <span>Theme</span>
                    </button>
                </div>
            </footer>
        </nav>

        <!-- Main Content Area -->
        <main id="main-content" class="flex-1 flex flex-col overflow-hidden" role="main">
            <!-- Editor Page -->
            <div id="page-editor" class="page active">
                <!-- Editor Header -->
                <div class="editor-header">
                    <div class="editor-title-section">
                        <input 
                            type="text" 
                            id="note-title" 
                            data-testid="note-title"
                            class="note-title-input" 
                            placeholder="Untitled Note"
                        >
                    </div>
                    <div class="editor-actions">
                        <span id="save-status" class="save-status" aria-live="polite" aria-atomic="true"></span>
                        <button id="save-btn" class="btn btn-primary btn-sm">
                            <i class="fas fa-save"></i>
                            <span>Save</span>
                        </button>
                    </div>
                </div>
                <!-- Editor Toolbar -->
                <div class="editor-toolbar">
                    <button id="btn-bold" class="btn btn-sm" title="Bold (Ctrl+B)"><i class="fas fa-bold"></i></button>
                    <button id="btn-italic" class="btn btn-sm" title="Italic (Ctrl+I)"><i class="fas fa-italic"></i></button>
                    <div style="width: 1px; height: 20px; background: var(--color-border-primary); margin: 0 var(--space-xs);"></div>
                    <button id="btn-h1" class="btn btn-sm" title="Heading 1"><span style="font-weight: var(--font-weight-semibold);">H1</span></button>
                    <button id="btn-h2" class="btn btn-sm" title="Heading 2"><span style="font-weight: var(--font-weight-semibold);">H2</span></button>
                    <button id="btn-h3" class="btn btn-sm" title="Heading 3"><span style="font-weight: var(--font-weight-semibold);">H3</span></button>
                    <div style="width: 1px; height: 20px; background: var(--color-border-primary); margin: 0 var(--space-xs);"></div>
                    <button id="btn-link" class="btn btn-sm" title="Link"><i class="fas fa-link"></i></button>
                    <button id="btn-wikilink" class="btn btn-sm" title="Wikilink"><i class="fas fa-bookmark"></i></button>
                    <button id="btn-check" class="btn btn-sm" title="Checklist"><i class="fas fa-square"></i></button>
                    <button id="btn-code" class="btn btn-sm" title="Code block"><i class="fas fa-code"></i></button>
                    <button id="btn-quote" class="btn btn-sm" title="Quote"><i class="fas fa-quote-left"></i></button>
                    <button id="btn-highlight" class="btn btn-sm" title="Highlight selected text"><i class="fas fa-highlighter"></i></button>
                    <div style="width: 1px; height: 20px; background: var(--color-border-primary); margin: 0 var(--space-xs);"></div>
                    <button id="btn-toggle-preview" class="btn btn-sm" title="Show/Hide Preview"><i class="fas fa-eye"></i></button>
                    <button id="btn-toggle-editor-mode" class="btn btn-sm" title="Switch Editor Mode"><i class="fas fa-pen"></i></button>
                    <button id="btn-outline" class="btn btn-sm" title="Toggle Outline"><i class="fas fa-list"></i></button>
                    <button id="btn-command-palette" class="btn btn-sm" title="Command Palette (⌘⇧P)"><i class="fas fa-terminal"></i></button>
                </div>
                    
                <!-- Editor Content -->
                <div class="editor-content">
                    <!-- Editor Panel -->
                    <div class="editor-pane">
                        <textarea 
                            id="note-body" 
                            data-testid="note-body"
                            class="editor-textarea" 
                            placeholder="Start writing your note..."
                        ></textarea>
                    </div>
                    
                    <!-- Splitter -->
                    <div id="editor-splitter" class="editor-splitter" role="separator" aria-label="Resize editor/preview" aria-orientation="vertical" tabindex="0"></div>
                    
                    <!-- Preview Panel -->
                    <div id="preview-panel" class="preview-pane">
                        <div class="preview-content">
                            <div id="note-preview" data-testid="note-preview" class="preview">
                                <!-- Rendered markdown preview -->
                            </div>
                        </div>
                    </div>

                    <!-- Outline Panel -->
                    <aside id="outline-panel" class="hidden" style="width: 256px; border-left: 1px solid var(--color-border-primary); background: var(--color-bg-secondary); overflow-y: auto;">
                        <div style="padding: var(--space-md);">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-sm);">
                                <h3 style="font-size: var(--font-size-sm); font-weight: var(--font-weight-semibold); color: var(--color-text-secondary);">Outline <span id="outline-count" style="font-size: var(--font-size-xs); color: var(--color-text-muted); margin-left: var(--space-xs);">0</span></h3>
                            </div>
                            <nav id="outline-list" style="display: flex; flex-direction: column; gap: var(--space-xs); font-size: var(--font-size-sm); color: var(--color-text-secondary);"></nav>
                        </div>
                    </aside>
                </div>
            </div>

            <!-- Graph Page -->
            <div id="page-graph" class="page">
                <div id="graph-container" data-testid="graph-container" style="width: 100%; height: 100%; position: relative;">
                    <svg id="graph-svg" style="width: 100%; height: 100%;"></svg>
                    <div class="graph-controls">
                        <button class="btn btn-sm" title="Toggle Link Mode"><i class="fas fa-exchange-alt"></i></button>
                        <button class="btn btn-sm" title="Center Graph"><i class="fas fa-compress-arrows-alt"></i></button>
                        <button class="btn btn-sm" title="Reset Zoom"><i class="fas fa-search-minus"></i></button>
                    </div>
                    <div class="graph-legend">
                        <div style="font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); color: var(--color-text-primary); margin-bottom: var(--space-xs);">Legend</div>
                        <div style="font-size: var(--font-size-xs); color: var(--color-text-muted);">Nodes: Notes • Links: Connections</div>
                    </div>
                </div>
            </div>

            <!-- Tags Page -->
            <div id="page-tags" class="page" style="padding: var(--space-xl);">
                <div data-testid="tags-container">
                    <h2 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--space-xl);">Tag Management</h2>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">All Tags</h3>
                        </div>
                        <div class="card-body">
                            <div id="tag-list" data-testid="tag-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: var(--space-md);">
                                <!-- Tags will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Page -->
            <div id="page-ai" class="page" style="padding: var(--space-xl);">
                <div>
                    <h2 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--space-xl);">AI Assistant</h2>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">AI Chat</h3>
                        </div>
                        <div class="card-body">
                            <div id="ai-chat-container" style="min-height: 400px; display: flex; flex-direction: column;">
                                <div id="ai-messages" style="flex: 1; margin-bottom: var(--space-md); padding: var(--space-md); background: var(--color-bg-primary); border-radius: var(--radius-md);">
                                    <p style="color: var(--color-text-muted); text-align: center;">Start a conversation with your AI assistant...</p>
                                </div>
                                <div style="display: flex; gap: var(--space-sm);">
                                    <input type="text" id="ai-input" class="form-input" placeholder="Ask me anything about your notes..." style="flex: 1;" />
                                    <button id="ai-send" class="btn btn-primary">
                                        <i class="fas fa-paper-plane"></i>
                                        <span>Send</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="page-settings" class="page" style="padding: var(--space-xl);">
                <div>
                    <h2 style="font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); color: var(--color-text-primary); margin-bottom: var(--space-xl);">Settings</h2>
                    <div style="max-width: 600px;">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Preferences</h3>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label">Theme</label>
                                    <select id="theme-select" class="form-select">
                                        <option value="dark">Dark</option>
                                        <option value="light">Light</option>
                                        <option value="system">System</option>
                                    </select>
                                </div>
                                
                                <div style="display: flex; gap: var(--space-sm); margin-bottom: var(--space-lg);">
                                    <button id="export-btn" data-testid="export-btn" class="btn btn-secondary">
                                        <i class="fas fa-download"></i>
                                        <span>Export Data</span>
                                    </button>
                                    <button id="import-btn" class="btn btn-secondary">
                                        <i class="fas fa-upload"></i>
                                        <span>Import Data</span>
                                    </button>
                                </div>
                                
                                <div style="border-top: 1px solid var(--color-border-primary); padding-top: var(--space-lg);">
                                    <button id="clear-data-btn" data-testid="clear-data-btn" class="btn btn-error">
                                        <i class="fas fa-trash"></i>
                                        <span>Clear All Data</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" data-testid="mobile-menu" class="fixed inset-0 z-40 lg:hidden hidden">
        <div class="modal-backdrop"></div>
        <nav class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-xl transform transition-transform">
            <!-- Mobile menu content will be populated here -->
        </nav>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2">
        <div id="toast" class="toast hidden">
            <div id="toast-content"></div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modal-container" class="hidden">
        <!-- Modals will be rendered here -->
    </div>

    <!-- App Ready Indicator for Testing -->
    <div id="app-ready" data-testid="app-ready" style="display: none;"></div>

    <!-- CDN Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.7/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
    <script src="https://unpkg.com/ulid@2.3.0/lib/index.umd.js"></script>

    <!-- Main Application Scripts -->
    <script src="js/util.js"></script>
    <script src="js/ui-enhancements.js"></script>
    <script src="js/store.js"></script>
    <script src="js/search.js"></script>
    <script src="js/graph.js"></script>
    <script src="js/tags.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/modern-app.js"></script>
    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof Init !== 'undefined') {
                Init.start();
            }
        });
    </script>
</body>
</html>
    <noscript>
        <div style="padding: 1rem; background: #fee2e2; color: #7f1d1d; text-align: center;">
            JavaScript is required to run Mahart Linked Notes.
        </div>
    </noscript>
