<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mahart Linked Notes - AI Project Showcase</title>
  <link rel="stylesheet" href="css/styles.css"/>
  <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
  <style>
    /* Custom AI showcase styles for complex gradients */
    .ai-showcase-header {
      background: linear-gradient(90deg, #0f1115, #151922);
      @apply border-b border-border p-3 -m-3 mb-3 text-center;
    }
    
    .ai-showcase-header h1 {
      @apply text-accent text-3xl m-0;
    }
  </style>
</head>
<body class="bg-bg text-text font-sans h-full m-0">
<div class="app-grid">
  <div class="topbar">
    <div class="flex gap-2">
      <button id="newNote" class="btn">New Note (⌘/Ctrl+N)</button>
    </div>
    <button id="saveNote" class="btn">Save (⌘/Ctrl+S)</button>
    <div class="flex-1 flex gap-2 relative">
      <div class="flex-1 relative">
        <input id="q" type="search" placeholder="Quick search (⌘/Ctrl+K): title, tags, body…" class="search-input" autocomplete="off"/>
        <div id="searchSuggestions" class="search-suggestions hidden"></div>
      </div>
    </div>
    <button id="tagsBtn" class="btn">Tags</button>
    <button id="graphBtn" class="btn">Graph</button>
    <button id="exportBtn" class="btn">Export</button>
    <button id="importBtn" class="btn">Import</button>
    <button id="settingsBtn" class="btn">Settings</button>
  </div>

  <div class="sidebar-left">
    <div class="section">
      <strong>Notes</strong> <span id="noteCount" class="badge">0</span>
      <div id="noteList"></div>
    </div>
    <div class="section">
      <strong>Tags</strong> <span id="tagCount" class="badge">0</span>
      <div id="tagList"></div>
    </div>
    <div class="section">
      <strong>Backlinks</strong>
      <div id="backlinks"></div>
    </div>
  </div>

  <div class="main-content">
    <div class="card">
      <h3 class="card-header flex items-center gap-2">
        Editor <span id="dirty" class="badge hidden">unsaved</span>
      </h3>
      <div class="h-editor overflow-auto p-3">
        <textarea id="editor" placeholder="# Title

Write with **Markdown**.
Link notes with [[Note Title]] or [[ID:xxxx]].
Add tags with #tag anywhere.
" class="editor-textarea"></textarea>
        
        <!-- Text Highlighting Controls -->
        <div id="highlightControls" class="hidden p-3 bg-card-bg border border-card-border rounded-lg mt-2">
          <div class="flex items-center justify-between mb-2">
            <span class="text-text">Highlight Text</span>
            <button onclick="UI.autoFixHighlights()" class="btn text-xs px-2 py-1 bg-btn-bg text-warning" title="Fix broken highlight syntax">Auto-Fix</button>
          </div>
          <div class="flex gap-1 mb-2">
            <button onclick="UI.applyHighlight('red')" class="w-8 h-8 bg-red-500 rounded hover:bg-red-600" title="Red highlight"></button>
            <button onclick="UI.applyHighlight('orange')" class="w-8 h-8 bg-orange-500 rounded hover:bg-orange-600" title="Orange highlight"></button>
            <button onclick="UI.applyHighlight('yellow')" class="w-8 h-8 bg-yellow-500 rounded hover:bg-yellow-600" title="Yellow highlight"></button>
            <button onclick="UI.applyHighlight('green')" class="w-8 h-8 bg-green-500 rounded hover:bg-green-600" title="Green highlight"></button>
            <button onclick="UI.applyHighlight('blue')" class="w-8 h-8 bg-blue-500 rounded hover:bg-blue-600" title="Blue highlight"></button>
            <button onclick="UI.applyHighlight('purple')" class="w-8 h-8 bg-purple-500 rounded hover:bg-purple-600" title="Purple highlight"></button>
          </div>
          <div>
            <button onclick="UI.removeHighlight()" class="btn bg-danger text-white" title="Remove highlight">Remove</button>
          </div>
        </div>
      </div>
      <div class="flex gap-2 p-2 border-t border-card-border">
        <input id="title" placeholder="Title" class="input-field flex-1"/>
        <div id="enhanced-tags-input" class="relative bg-input-bg border border-input-border rounded-lg p-2 min-h-10">
            <div class="tags-display" id="tagsDisplay"></div>
            <input type="text" id="tagInput" class="bg-transparent border-none outline-none text-text" placeholder="Add tags..."/>
            <div class="tag-suggestions" id="tagSuggestions"></div>
        </div>
        <button id="saveNoteInline" class="btn ml-2" title="Save note (⌘/Ctrl+S)">Save</button>
      </div>
      <div class="editor-status px-3 py-1 border-t border-card-border text-xs text-muted bg-editor-header" id="editorStatus">
        <span>Words: 0</span> | <span>Chars: 0</span> | <span>Lines: 1</span> | <span>Tags: 0</span> | <span>Links: 0</span>
      </div>
    </div>

    <div class="card">
      <h3 class="card-header">Live Preview</h3>
      <div id="preview" class="h-editor overflow-auto p-3"></div>
    </div>
  </div>

  <div class="sidebar-right">
    <div class="section">
      <div class="kpi-grid">
        <div class="kpi-box"><div class="text-xs text-muted">Notes</div><div id="kpiNotes" class="text-xl"></div></div>
        <div class="kpi-box"><div class="text-xs text-muted">Links/Note</div><div id="kpiLinks" class="text-xl"></div></div>
        <div class="kpi-box"><div class="text-xs text-muted">% ≥2 Links</div><div id="kpiHealth" class="text-xl"></div></div>
      </div>
      <hr class="border-border my-3"/>
      <canvas id="chartActivity" height="120"></canvas>
      <hr class="border-border my-3"/>
      <div id="miniGraph" class="min-h-32"></div>
    </div>

    <div class="section">
      <strong>Performance</strong>
      <div id="perfBox" class="code-block"></div>
    </div>

    <div class="section">
      <strong>Events</strong>
      <div id="eventLog" class="code-block max-h-40"></div>
    </div>
  </div>
</div>

<div id="toast" class="fixed bottom-4 right-4 bg-success text-white px-4 py-2 rounded-lg shadow-app transform translate-y-full opacity-0 transition-all duration-300">Saved</div>

<!-- Tags Management Modal -->
<dialog id="tagsModal" class="backdrop:bg-black backdrop:bg-opacity-50 bg-transparent border-none p-0">
  <div class="card p-4 min-w-[600px] max-h-[80vh] overflow-auto">
    <div class="flex justify-between items-center mb-4">
      <h3 class="m-0 text-xl font-semibold text-text">Tag Management</h3>
      <button class="btn px-2 py-1" onclick="el('#tagsModal').close()">×</button>
    </div>
    
    <div class="mb-4">
      <div class="flex gap-2 mb-2">
        <input id="newTagInput" placeholder="Create new tag (e.g., #project)" class="input-field flex-1">
        <button class="btn" onclick="UI.createNewTag()">Add Tag</button>
      </div>
      <div class="text-xs text-muted">Tags are automatically created when you use #hashtags in notes</div>
    </div>

    <div class="flex gap-4">
      <div class="flex-1">
        <h4 class="text-lg font-medium mb-2">All Tags <span id="totalTagCount" class="badge">0</span></h4>
        <div id="allTagsList" class="max-h-72 overflow-auto border border-card-border rounded-lg p-2"></div>
      </div>
      
      <div class="flex-1">
        <h4 class="text-lg font-medium mb-2">Tag Details</h4>
        <div id="tagDetails" class="border border-card-border rounded-lg p-3 min-h-48">
          <div class="text-muted text-center py-10">Select a tag to view details</div>
        </div>
      </div>
    </div>

    <div class="mt-4 flex gap-2">
      <button class="btn" onclick="UI.exportTags()">Export Tags</button>
      <button class="btn bg-red-900 text-danger border-red-800" onclick="UI.cleanupUnusedTags()">Cleanup Unused</button>
      <button class="btn ml-auto" onclick="el('#tagsModal').close()">Close</button>
    </div>
  </div>
</dialog>

<!-- Graph Visualization Modal -->
<dialog id="graphModal" class="backdrop:bg-black backdrop:bg-opacity-50 bg-transparent border-none p-0">
  <div class="card p-4 min-w-[800px] max-h-[80vh]">
    <div class="flex justify-between items-center mb-4">
      <h3 class="m-0 text-xl font-semibold text-text">Knowledge Graph</h3>
      <button class="btn px-2 py-1" onclick="el('#graphModal').close()">×</button>
    </div>
    
    <div class="mb-4">
      <div class="flex gap-2">
        <button class="btn" onclick="UI.renderGraph()">Refresh Graph</button>
        <button class="btn" onclick="UI.centerGraph()">Center View</button>
        <button class="btn" onclick="UI.exportGraph()">Export Image</button>
      </div>
    </div>

    <div id="graphContainer" class="w-full h-[500px] border border-card-border rounded-lg bg-card-bg">
      <div class="flex items-center justify-center h-full text-muted">
        Graph will render here
      </div>
    </div>

    <div class="mt-4">
      <button class="btn" onclick="el('#graphModal').close()">Close</button>
    </div>
  </div>
</dialog>

<dialog id="settings" class="backdrop:bg-black backdrop:bg-opacity-50 bg-transparent border-none p-0">
  <form method="dialog" class="card p-4 min-w-[420px]">
    <h3 class="text-xl font-semibold text-text mb-4">Settings</h3>
    <label class="flex items-center justify-between py-2 text-sm">
      <span>Auto-link on save:</span>
      <input id="autoLink" type="checkbox" checked class="ml-2">
    </label>
    <label class="flex items-center justify-between py-2 text-sm">
      <span>Enable analytics:</span>
      <input id="enableAnalytics" type="checkbox" checked class="ml-2">
    </label>
    <label class="flex items-center justify-between py-2 text-sm">
      <span>Realtime multi-tab sync:</span>
      <input id="enableBC" type="checkbox" checked class="ml-2">
    </label>
    <hr class="border-border my-4"/>
    <button class="btn" value="cancel">Close</button>
  </form>
</dialog>

<input id="importFile" type="file" accept="application/json" hidden/>

<!-- Essential scripts only -->
<script src="js/util.js"></script>
<script src="js/store.js"></script>
<script src="js/search.js"></script>
<script src="js/analytics.js"></script>
<script src="js/graph.js"></script>
<script src="js/tags.js"></script>
<script src="js/templates.js"></script>
<script src="js/recommendations.js"></script>
<script src="js/collaboration.js"></script>
<script src="js/graph-analytics.js"></script>
<script src="js/query-engine.js"></script>
<script src="js/advanced-viz.js"></script>
<script src="js/ai-assistant.js"></script>
<script src="js/advanced-ui.js"></script>
<script src="js/plugin-system.js"></script>
<script src="js/data-management.js"></script>
<script src="js/advanced-search.js"></script>
<script src="js/advanced-editor.js"></script>
<script src="js/monetization.js"></script>
<script src="js/workspace.js"></script>
<script src="js/themes.js"></script>
<script src="js/presentation-generator.js"></script>
<script src="js/smart-templates.js"></script>
<script src="js/learning-mode.js"></script>
<script src="js/theme-editor.js"></script>
<script src="js/competitive-importers.js"></script>
<script src="js/dynamic-dashboards.js"></script>
<script src="js/app.js"></script>
<script src="js/init.js"></script>


</body>
</html>
